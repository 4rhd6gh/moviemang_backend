#!groovy
@Library('dockerBuild') _
pipeline {
    agent any

    environment{
        echo GIT_COMMIT %GIT_COMMIT% 
echo GIT_BRANCH %GIT_BRANCH%
echo GIT_LOCAL_BRANCH %GIT_LOCAL_BRANCH%
echo GIT_PREVIOUS_COMMIT %GIT_PREVIOUS_COMMIT%
echo GIT_PREVIOUS_SUCCESSFUL_COMMIT %GIT_PREVIOUS_SUCCESSFUL_COMMIT%
echo GIT_URL %GIT_URL%
echo GIT_URL_N - %GIT_URL_N%
echo GIT_AUTHOR_NAME %GIT_AUTHOR_NAME%
echo GIT_COMMITTER_EMAIL %GIT_COMMITTER_EMAIL%
    }
    
    stages {
        stage('Docker Build') {
        steps {
            dockerBuild("${GIT_COMMIT_TAG}", "${}")
            sh '''
            echo "Building Docker Image"
            pwd
            '''
            }
        }
        stage('Docker RUN') {
            steps {
                sh '''
                echo "Docker RUN"
                docker rm -f mmback
                docker run -d -p 8000:8000 --name mmback ${GIT_COMMIT_TAG}
                '''
            }
        }
    }
}